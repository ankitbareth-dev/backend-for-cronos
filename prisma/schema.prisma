datasource db { 
  provider = "postgresql" 
  url      = env("DATABASE_URL") 
}

generator client { 
  provider = "prisma-client-js" 
}

model User {
  id         String        @id @default(uuid())
  name       String
  email      String        @unique
  password   String
  createdAt  DateTime      @default(now())

  matrices   TimeMatrix[]
  cells      MatrixCell[]
}

model TimeMatrix {
  id         String        @id @default(uuid())
  name       String
  createdAt  DateTime      @default(now())

  
  user       User          @relation(fields: [userId], references: [id], onDelete: Cascade)
  userId     String

 
  matrixData MatrixData?


  categories Category[]

  @@index([userId])
}

model MatrixData {
  id        String      @id @default(uuid())
  startDate DateTime
  endDate   DateTime
  startTime String
  endTime   String
  interval  Int
  createdAt DateTime    @default(now())

  
  matrix    TimeMatrix  @relation(fields: [matrixId], references: [id], onDelete: Cascade)
  matrixId  String      @unique

  
  cells     MatrixCell[]
}

model Category {
  id        String      @id @default(uuid())
  name      String
  color     String
  createdAt DateTime    @default(now())

 
  matrix    TimeMatrix  @relation(fields: [matrixId], references: [id], onDelete: Cascade)
  matrixId  String

  @@index([matrixId])
}


model MatrixCell {
  id           String      @id @default(uuid())
  index        Int         
  colorHex     String?
  createdAt    DateTime    @default(now())

  user         User        @relation(fields: [userId], references: [id], onDelete: Cascade)
  userId       String      

  matrixData   MatrixData  @relation(fields: [matrixDataId], references: [id], onDelete: Cascade)
  matrixDataId String      

  @@index([matrixDataId])
  @@index([index])
  @@unique([matrixDataId, index, userId]) 
}

